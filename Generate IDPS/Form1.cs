
//▒██   ██▒▒██   ██▒▒██   ██▒   ▄▄▄█████▓ ██░ ██ ▓█████    ▓█████▄  ▄▄▄       ██▀███   ██ ▄█▀ ██▓███   ██▀███   ▒█████    ▄████  ██▀███   ▄▄▄       ███▄ ▄███▓▓█████  ██▀███     ▒██   ██▒▒██   ██▒▒██   ██▒
//▒▒ █ █ ▒░▒▒ █ █ ▒░▒▒ █ █ ▒░   ▓  ██▒ ▓▒▓██░ ██▒▓█   ▀    ▒██▀ ██▌▒████▄    ▓██ ▒ ██▒ ██▄█▒ ▓██░  ██▒▓██ ▒ ██▒▒██▒  ██▒ ██▒ ▀█▒▓██ ▒ ██▒▒████▄    ▓██▒▀█▀ ██▒▓█   ▀ ▓██ ▒ ██▒   ▒▒ █ █ ▒░▒▒ █ █ ▒░▒▒ █ █ ▒░
//░░  █   ░░░  █   ░░░  █   ░   ▒ ▓██░ ▒░▒██▀▀██░▒███      ░██   █▌▒██  ▀█▄  ▓██ ░▄█ ▒▓███▄░ ▓██░ ██▓▒▓██ ░▄█ ▒▒██░  ██▒▒██░▄▄▄░▓██ ░▄█ ▒▒██  ▀█▄  ▓██    ▓██░▒███   ▓██ ░▄█ ▒   ░░  █   ░░░  █   ░░░  █   ░
// ░ █ █ ▒  ░ █ █ ▒  ░ █ █ ▒    ░ ▓██▓ ░ ░▓█ ░██ ▒▓█  ▄    ░▓█▄   ▌░██▄▄▄▄██ ▒██▀▀█▄  ▓██ █▄ ▒██▄█▓▒ ▒▒██▀▀█▄  ▒██   ██░░▓█  ██▓▒██▀▀█▄  ░██▄▄▄▄██ ▒██    ▒██ ▒▓█  ▄ ▒██▀▀█▄      ░ █ █ ▒  ░ █ █ ▒  ░ █ █ ▒ 
//▒██▒ ▒██▒▒██▒ ▒██▒▒██▒ ▒██▒     ▒██▒ ░ ░▓█▒░██▓░▒████▒   ░▒████▓  ▓█   ▓██▒░██▓ ▒██▒▒██▒ █▄▒██▒ ░  ░░██▓ ▒██▒░ ████▓▒░░▒▓███▀▒░██▓ ▒██▒ ▓█   ▓██▒▒██▒   ░██▒░▒████▒░██▓ ▒██▒   ▒██▒ ▒██▒▒██▒ ▒██▒▒██▒ ▒██▒
//▒▒ ░ ░▓ ░▒▒ ░ ░▓ ░▒▒ ░ ░▓ ░     ▒ ░░    ▒ ░░▒░▒░░ ▒░ ░    ▒▒▓  ▒  ▒▒   ▓▒█░░ ▒▓ ░▒▓░▒ ▒▒ ▓▒▒▓▒░ ░  ░░ ▒▓ ░▒▓░░ ▒░▒░▒░  ░▒   ▒ ░ ▒▓ ░▒▓░ ▒▒   ▓▒█░░ ▒░   ░  ░░░ ▒░ ░░ ▒▓ ░▒▓░   ▒▒ ░ ░▓ ░▒▒ ░ ░▓ ░▒▒ ░ ░▓ ░
//░░   ░▒ ░░░   ░▒ ░░░   ░▒ ░       ░     ▒ ░▒░ ░ ░ ░  ░    ░ ▒  ▒   ▒   ▒▒ ░  ░▒ ░ ▒░░ ░▒ ▒░░▒ ░       ░▒ ░ ▒░  ░ ▒ ▒░   ░   ░   ░▒ ░ ▒░  ▒   ▒▒ ░░  ░      ░ ░ ░  ░  ░▒ ░ ▒░   ░░   ░▒ ░░░   ░▒ ░░░   ░▒ ░
// ░    ░   ░    ░   ░    ░       ░       ░  ░░ ░   ░       ░ ░  ░   ░   ▒     ░░   ░ ░ ░░ ░ ░░         ░░   ░ ░ ░ ░ ▒  ░ ░   ░   ░░   ░   ░   ▒   ░      ░      ░     ░░   ░     ░    ░   ░    ░   ░    ░  
// ░    ░   ░    ░   ░    ░               ░  ░  ░   ░  ░      ░          ░  ░   ░     ░  ░               ░         ░ ░        ░    ░           ░  ░       ░      ░  ░   ░         ░    ░   ░    ░   ░    ░  
//                                                          ░                                                        

//====================================================================================================================================================================================================================
//                                          Under Proetection From Myself 
//====================================================================================================================================================================================================================

///Dam My Name Looks Sexy hahah 
///Anyway Marco here is the source i have so far it still needs a few fixes as it needs the model seletion never goes beyond 
///offset 0x30 Correlating with Model Number as You Suggested 
/// No We Need To Check Via Serial For Any Indications
/// e.g if your serial is ############ the part before the cech i belive might be the following parts of the idps but ill look into this more after work 


using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace Generate_IDPS
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }
        int count=0;
        string finalString  = ""; //Basic Outlay of the System IDPS's ? Seems Each Region Starts with 8 then has its own value 
        public byte[] ReadHexStringToByte(string Input)
        {
            Input = Input.ToUpper().Trim();
            string ValidChar = "0123456789ABCDEF";
            foreach (char character in Input)
            {
                if (!ValidChar.Contains(character))
                    throw new Exception("Invalid HexString");
            }
            if (Input.Length == 0)
                throw new Exception("Hexstring resulted in NULL");
            if (!(Input.Length % 2 == 0))
                Input = "0" + Input;
            byte[] ResultBytes = new byte[(Input.Length / 2)];
            int index = 0;
            for (int i = 0; i <= Input.Length - 1; i +=2)
            {
                try
                {
                    ResultBytes[index] = Convert.ToByte(Input.Substring(i, 2), 16);
                    index += 1;
                }
                catch
                {
                    return ResultBytes;
                }
            }
            return ResultBytes;
        }

        private void button1_Click(object sender, EventArgs e)
        {
            
            //Run In A Bacgoruding Worker To Avoid Prying Eyes 
            backgroundWorker1.RunWorkerAsync();
            
         }

        private void Form1_Load(object sender, EventArgs e)
        {
            //Allways Set The COmbobox And Dont Allow User Text 
            comboBox1.SelectedIndex = 0;
        }

        private void backgroundWorker1_DoWork(object sender, DoWorkEventArgs e)
        {

            {
                //Magic Static 

                finalString = "00000001008";

                int switchvar = 0;
                comboBox1.Invoke(new Action(() => switchvar = comboBox1.SelectedIndex));
                //Region Codes By MARCO !!!! Your A Legend Man
                switch (switchvar)
                {
                    case 0:
                        finalString += "3"; //JP
                        break;
                    case 1:
                        finalString += "4";//US/CA
                        break;
                    case 2:
                        finalString += "9";//AU/NZ
                        break;
                    case 3:
                        finalString += "7";//UK/IE
                        break;
                    case 4:
                        finalString += "5";//EU/ME/AF
                        break;
                    case 5:
                        finalString += "6";//KR
                        break;
                    case 6:
                        finalString += "A";//SG/MY
                        break;
                    case 7:
                        finalString += "B";//TW
                        break;
                    case 8:
                        finalString += "C";//RU/UA/IN/C(Asia)
                        break;
                    case 9:
                        finalString += "D";//CN
                        break;
                    case 10:
                        finalString += "8";//MX/SA   I Missed One -_- HK not important as no one from testers is HK
                        break;
                    default:
                        MessageBox.Show("Something Went Wrong or your just stupid as hell \n\n sence of humor detected ?");
                        break;

                }
                //Seperator 
                finalString += "00";

                //Model type 
                //this should actually be gotten from model number but ehhh whatever

                comboBox2.Invoke(new Action(() => finalString += comboBox2.Text));

                //chassis check 

                var oldArray = new int?[] { 1, 2, 3, 4, 5, 6 };

                /*
                 * 
                 * (0x1400 >> 0xA) = 5d or 0x1400h thus 1010000000000b then shift the pointer left by 0xDh resulting in 101b or 0x5h
                 * 
                 */



                var chars = "0123456789ABCDEF";

                var stringChars = new char[12];

                var random = new Random();


                /// This Needs To CHange As This Links To The Model Number Meaning That After FinalString 00000108[region] comes the model 
                /// never goes higher that 0x30 thanks pink that was the final conclusion i needed 
                /// MARCO AND PINK !! ROCK ON

                for (int i = 0; i < stringChars.Length; i++)
                {
                    stringChars[i] = chars[random.Next(chars.Length)];
                }
                count++;
                finalString += new String(stringChars).ToString();
            }
        }

        private void backgroundWorker1_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
        {
            MessageBox.Show("Found Idps.bin after " + count + " tries ");
            string Lines = finalString;


            var result = ReadHexStringToByte(finalString);

            System.IO.File.WriteAllBytes(Application.StartupPath + @"\\idps.bin", result);

            MessageBox.Show(BitConverter.ToString(System.IO.File.ReadAllBytes(Application.StartupPath + @"\\idps.bin")));
        }
    }
}
